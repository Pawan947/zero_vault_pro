<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Video Player - <%= filename %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      margin: 0;
      background: #121212;
      color: #fff;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .video-frame {
      position: relative;
      width: 90%;
      max-width: 1000px;
      background: #000;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.7);
    }
    video {
      width: 100%;
      height: auto;
      display: block;
    }
    .controls-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.5);
      padding: 10px 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      opacity: 1;
      transition: opacity 0.3s;
    }
    .controls-overlay.hidden {
      opacity: 0;
    }
    .controls-overlay button,
    .controls-overlay select,
    .controls-overlay input[type="range"] {
      margin: 0 5px;
    }
    .back-btn {
      position: absolute;
      top: 15px;
      left: 15px;
      z-index: 10;
      background: rgba(0,0,0,0.5);
      border: none;
      color: #fff;
      padding: 6px 12px;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <div class="video-frame" id="videoFrame">
    <button class="back-btn" onclick="window.location='/'">Back</button>
    <video id="videoPlayer" autoplay>
      <source src="/video/<%= encodeURIComponent(filename) %>?path=<%= encodeURIComponent(currentPath) %><% if(sharedId){ %>&sharedId=<%= sharedId %><% } %>" type="video/mp4">
      Your browser does not support HTML5 video.
    </video>

    <div class="controls-overlay" id="controlsOverlay">
      <div>
        <button id="playPause" class="btn btn-sm btn-primary">Pause</button>
        <button id="mute" class="btn btn-sm btn-secondary">Mute</button>
      </div>
      <div>
        <label for="volume">Volume</label>
        <input type="range" id="volume" min="0" max="1" step="0.05" value="1">
      </div>
      <div>
        <label for="speed">Speed</label>
        <select id="speed">
          <option value="0.25">0.25x</option>
          <option value="0.5">0.5x</option>
          <option value="0.75">0.75x</option>
          <option value="1" selected>1x</option>
          <option value="1.25">1.25x</option>
          <option value="1.5">1.5x</option>
          <option value="2">2x</option>
        </select>
      </div>
      <div>
        <button id="fullscreen" class="btn btn-sm btn-success">Fullscreen</button>
      </div>
    </div>
  </div>

  <script>
    const video = document.getElementById('videoPlayer');
    const playPause = document.getElementById('playPause');
    const mute = document.getElementById('mute');
    const volume = document.getElementById('volume');
    const speed = document.getElementById('speed');
    const fullscreen = document.getElementById('fullscreen');
    const controlsOverlay = document.getElementById('controlsOverlay');
    const videoFrame = document.getElementById('videoFrame');

    // Play/Pause toggle
    playPause.addEventListener('click', () => {
      if(video.paused){ video.play(); playPause.textContent = 'Pause'; }
      else{ video.pause(); playPause.textContent = 'Play'; }
    });

    // Mute toggle
    mute.addEventListener('click', () => {
      video.muted = !video.muted;
      mute.textContent = video.muted ? 'Unmute' : 'Mute';
    });

    // Volume
    volume.addEventListener('input', () => { video.volume = volume.value; });

    // Playback speed
    speed.addEventListener('change', () => { video.playbackRate = speed.value; });

    // Fullscreen
    fullscreen.addEventListener('click', () => {
      if(video.requestFullscreen) video.requestFullscreen();
      else if(video.webkitRequestFullscreen) video.webkitRequestFullscreen();
      else if(video.msRequestFullscreen) video.msRequestFullscreen();
    });

    // Auto fullscreen on load
    window.addEventListener('load', () => {
      setTimeout(() => {
        if(video.requestFullscreen) video.requestFullscreen();
        else if(video.webkitRequestFullscreen) video.webkitRequestFullscreen();
        else if(video.msRequestFullscreen) video.msRequestFullscreen();
      }, 500);
    });

    // Auto-hide controls
    let hideTimeout;
    function showControls() {
      controlsOverlay.classList.remove('hidden');
      clearTimeout(hideTimeout);
      hideTimeout = setTimeout(() => { controlsOverlay.classList.add('hidden'); }, 3000);
    }
    videoFrame.addEventListener('mousemove', showControls);
    videoFrame.addEventListener('click', showControls);
    showControls(); // initial
  </script>
</body>
</html>
